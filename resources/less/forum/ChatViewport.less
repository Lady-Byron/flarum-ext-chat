.ChatViewport {
  /* chat 区域背景 */
  background: rgba(0,0,0,.1);

  /* —— 尺寸参数（避免使用 CSS var + calc，引发 lessphp 报错） —— */
  @bubble-max: 72%;
  @bubble-fs: 15.5px;
  @bubble-lh: 1.55;
  @bubble-py: 8px;
  @bubble-px: 12px;
  @bubble-r: 14px;
  @avatar: 32px;      // 头像直径
  @gap: 9px;          // 头像与内容间距
  @tools-w: 92px;     // 右侧工具区预留宽度（时间戳 + … 菜单）

  .UserMention{
    .user-select(none);
    a{color:rgba(46,96,177,.9) !important;}
    display:inline-block;color:rgba(105,122,150,.9) !important;background:rgba(255,255,255,.1);
    border-radius:6px;padding:2px 8px;margin:2px 3px;border:1px solid rgba(255,255,255,.15) !important;
    backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);
  }
  .UserMention:hover{ a{color:@glass-text !important;} color:@glass-text !important; background:rgba(255,255,255,.15); }

  .scroller{
    width:40px;height:40px;position:absolute;background:rgba(255,255,255,.15);
    backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);
    opacity:.8;color:@glass-text;right:30px;bottom:70px;border-radius:100px;line-height:40px;font-size:24px;text-align:center;
    cursor:pointer;box-shadow:0 4px 16px rgba(0,0,0,.1);.transition(all .2s ease);
    &:hover{opacity:1;background:rgba(255,255,255,.2);transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.15);}
    .loading{position:absolute;top:425px;float:left;right:15px;}
  }

  .wrapper{
    overflow-y:scroll;overflow-x:hidden;height:100%;

    .welcome{margin:auto;margin-top:150px;text-align:center;
      h1{display:block;font-size:25pt;margin:5px;color:@glass-text;font-weight:300;}
      span{display:block;color:@glass-text-muted;}
    }

    .message-wrapper,
    .message-wrapper--loading{
      display:block;position:relative;margin:6px 0;border-radius:8px;transition:all .2s ease;
      padding:8px 12px 8px 12px;
      &:hover{background:rgba(255,255,255,.05);}
      &.odd{background:rgba(255,255,255,.03);}
      &.editing{ .avatar-wrapper,.name,.labels,.message,.timestamp{opacity:.6;} }
      &.hidden { .avatar-wrapper,.name,.labels,.message,.timestamp{opacity:.3;} }
      &.deleted{display:none;}

      /* 头像 */
      .avatar-wrapper{position:absolute;top:8px;left:12px;
        .avatar{width:@avatar;height:@avatar;border-radius:@avatar;font-size:(@avatar/2);line-height:@avatar;cursor:pointer;}
      }
      /* 自己的消息：头像在右 */
      &.mine .avatar-wrapper{left:auto;right:12px;}

      /* 气泡区域与工具区预留 */
      .message-block{
        margin-left:(@avatar + @gap + 12);
        margin-right:@tools-w;
        position:relative;
        padding-right:0;

        /* 气泡 */
        .message{
          display:inline-block;max-width:@bubble-max;font-size:@bubble-fs;line-height:@bubble-lh;
          padding:@bubble-py @bubble-px;border-radius:@bubble-r;min-height:30px;word-break:break-word;white-space:normal;
          color:@glass-text;background:rgba(255,255,255,.92);box-shadow:0 1px 1.5px rgba(0,0,0,.08);
        }
      }

      /* 其他人的消息（左侧气泡样式） */
      &.others .message{
        background:rgba(255,255,255,.92);color:#111;
        border-top-left-radius:6px;border-top-right-radius:@bubble-r;
      }

      /* 自己的消息（右侧排布与主色气泡） */
      &.mine {
        .message-block{
          margin-right:(@avatar + @gap + 12);
          margin-left:@tools-w;
          text-align:right;
        }
        .message{
          background: var(--primary-color, #4aa3ff);
          color:#fff;
          border-top-right-radius:6px;border-top-left-radius:@bubble-r;
        }
        .toolbar .right{left:0;right:auto;text-align:left;padding-left:5px;padding-right:0;}
      }

      span[data-name]:hover:after{
        content:attr(data-name);padding:6px 10px;color:@glass-text;background:rgba(0,0,0,.8);
        backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
        position:absolute;white-space:nowrap;z-index:20;border-radius:8px;box-shadow:0 4px 16px rgba(0,0,0,.2);font-size:12px;
      }

      /* 系统事件 */
      .event{
        min-height:25px;color:@glass-text-muted;text-align:center;padding:8px;line-height:1.5;margin-right:100px;
        background:rgba(255,255,255,.05);border-radius:8px;margin:4px 0;
        i{vertical-align:text-bottom;font-size:14pt;padding:0 2px;}
        .timestamp{color:@glass-text-muted;position:absolute;right:8px;line-height:2;top:7px;width:100px;text-align:right;font-size:12px;white-space:nowrap;}
        .chat-title{max-width:150px;text-overflow:ellipsis;display:inline-block;white-space:nowrap;}
      }

      /* 媒体与链接规范 */
      .message{
        /* emoji */
        img.emoji,.emoji{height:1.1em !important;width:1.1em !important;display:inline-block !important;vertical-align:-.15em;max-width:none !important;max-height:none !important;border:0;padding:0;}
        /* 普通图片 */
        img:not(.emoji){max-height:290px;max-width:100%;height:auto;border-radius:8px;display:block;}
        /* 视频 */
        video{max-width:100% !important;width:100% !important;max-height:290px !important;height:auto !important;display:block !important;box-sizing:border-box !important;border-radius:8px;}
        /* 音频 */
        audio{
          max-width:290px !important;width:100% !important;height:40px !important;min-height:40px !important;display:block !important;margin:8px 0 !important;border-radius:8px !important;
          background:rgba(255,255,255,.15) !important;border:1px solid rgba(255,255,255,.3) !important;outline:none !important;
          &::-webkit-media-controls-panel{background-color:rgba(255,255,255,.1);border-radius:8px;height:40px;}
          &::-webkit-media-controls-play-button{background-color:rgba(255,255,255,.8);border-radius:50%;width:30px;height:30px;}
          &::-webkit-media-controls-timeline{background-color:rgba(255,255,255,.3);border-radius:4px;height:4px;}
          &::-webkit-media-controls-volume-slider{background-color:rgba(255,255,255,.3);border-radius:4px;}
          &::-webkit-media-controls-current-time-display,&::-webkit-media-controls-time-remaining-display{color:rgba(255,255,255,.9);font-size:12px;}
        }
        /* p/div 容器兜底 */
        p{max-width:100% !important;overflow:hidden !important;margin:0 !important;padding:0 !important;
          video{max-width:100% !important;width:100% !important;height:auto !important;display:block !important;box-sizing:border-box !important;}
        }
        div{max-width:100% !important;
          video{max-width:100% !important;width:100% !important;height:auto !important;display:block !important;}
        }
        [controls]{max-width:100% !important;width:100% !important;height:auto !important;}
        iframe,embed,object{max-width:100% !important;width:100% !important;height:auto !important;border-radius:8px;display:block !important;box-sizing:border-box !important;}
        a{cursor:pointer;color:rgba(0,122,255,.8);text-decoration:none;font-weight:500;&:hover{color:rgba(0,122,255,1);}}
      }

      /* 悬停时强制显示编辑菜单 */
      &:hover { .ButtonGroup { opacity:1 !important; } }

      .toolbar{
        position:relative;min-height:20px;padding-bottom:2px;
        /* 保持 .name 选择器供装饰插件使用，放大字号/加粗 */
        .name{display:inline;color:@glass-text;font-weight:700;cursor:pointer;font-size:15px;}
        .labels{display:inline;opacity:1; .icon{display:inline-block;color:@glass-text-muted;padding:0 5px; span{font-size:9pt;} } }
        .right{
          display:inline;position:absolute;top:0;right:0;z-index:3; /* 高于气泡 */
          .edit{
            display:inline;padding:0 5px;
            .ButtonGroup{width:unset;} .ButtonGroup:not(.open){opacity:0;}
            .Button:hover,.Button:focus{background:rgba(255,255,255,.15);color:@glass-text;border-radius:6px;}
            .open>.Button{background:rgba(255,255,255,.15) !important;color:@glass-text !important;border-radius:6px;}
            .Button--icon{width:24px !important;height:24px !important;padding:0;text-align:center;}
          }
          .timestamp{display:inline;color:@glass-text-muted;cursor:pointer;padding-right:5px;text-align:right;white-space:nowrap;font-size:12px;overflow:hidden;text-overflow:ellipsis;}
        }
      }

      .message p,
      .message div:not(.LoadingIndicator){display:inline;margin:0;padding:0;}
    }
  }

  @media @phone{ .wrapper{ /* 移动端气泡更宽 */ @bubble-max: 85%; } }
}

